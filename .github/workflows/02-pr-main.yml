name: PR Main

on:
  pull_request:
    branches: [ main ]
    paths:
      - "infra/**"
      - "src/**"
      - "api/**"
      - "model/**"
      - "monitoring/**"
      - "shared/**"
      - "tests/**"

jobs:
  lint:
    uses: ./.github/workflows/_reusable-lint.yml
    with:
      working-directory: .
    secrets:
      inherit

  tests:
    uses: ./.github/workflows/_reusable-tests.yml
    with:
      working-directory: .
    secrets:
      inherit

  terraform-plan-prod:
    uses: ./.github/workflows/_reusable-terraform-plan.yml
    with:
      working-directory: infra/envs/prod
    secrets:
      aws-infra-role-arn: ${{ secrets.AWS_INFRA_ROLE_ARN }}
      aws-region: ${{ secrets.AWS_REGION }}
